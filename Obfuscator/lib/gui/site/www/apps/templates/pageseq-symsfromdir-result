<% use obfui::cmn;    my ($dirnm,$rx,$syms,$filenames) = @_; %>

<%$ sprintf(__('Here is a list of symbols extracted from directory <tt>%s</tt> for files matching regular expression <tt>%s</tt>'),
    $dirnm,$rx) %>

<% $forge->include('wgt-optional-start','filelist',__('List of files processed')) %>
<% foreach my $fn (@$filenames) { %>
<%=	$fn %><br>
<% }  %>
<% $forge->include('wgt-optional-end','filelist') %>
<p>


<%$ __("You may paste the collected names into <a class=menuitemref href=syms.edituser.main>Symbols &rArr; Edit user-specified exceptions</tt></a> screen to protect those symbols from being renamed.") %>

<% if (0) { %>

<style type=text/css>
.symlist { max-height: 700px; overflow:scroll; }
</style>
<pre class=symlist>
<%= join("\n",@$syms) %>
</pre>

<% } else { %>
<center>
<textarea name=symbols class=symlist id=symbols dirname="<%= $dirnm %>">
<%= join("\n",@$syms) %>
</textarea></center>

<% } %>


<p>
<% $forge->include('wgt-submitbtn',__('Append to exceptions'),'appendbtn',
    __('Append found symbols to Symbols &rArr; Edit user-specified exceptions'))  %>

<% $forge->include('wgt-backbtn',__('Run new query')) %>


<script>
J(function() {
    J("#appendbtn").on("click",function() {

	var txt = J('#symbols').val();

	var now = new Date();
	var formated_date = now.toLocaleDateString();
	txt = "\\n\\n#Appended from Tools -> 'Extract symbols from directory with source files' for  "  +
	    J('#symbols').attr('dirname') + " on " + formated_date  + "\\n" +  txt;

        var url_ = 'syms.append.main';
        jQuery.ajax({
           type: "POST",
           url: url_,
           data: { 'havevals':1, 'symbols': txt } ,
           success: function(data)
           {
		//alert("adding " + txt);
		mygrowl("Done appending symbols");
           }
         });
    });    
} );
</script>
