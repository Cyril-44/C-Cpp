<% use obfui::cmn;    my ($lines,$filename,$what,$cfg) = @_; %>
<form method=post id="form" kind="<%= $what %>"  saved_string="<%= __('Saved') %>">
<input type=hidden name=havevals value=1>
<%$ $what ne 'mapping' ?
    __('List of symbols, one per line (anything after <tt>#</tt> is ignored in each line): ') :
    __('This page allows to force some specific replacement for particular symbol. Enter list of symbol pairs, source then replacement (e.g. "myListOfProducts fooBlah"), one pair per line (anything after # is ignored in each line, so you may put comments here): ')
%>
<p>

<% if (!($what eq 'suffix' || $what eq 'mapping')) { %>
<small><%$ __('Enter names of symbols, not fully-qualifed names containing class name like <tt>foo::bar</tt> or <tt>baz::blah::foo()</tt> - enter just <tt>bar</tt> or <tt>foo</tt>.') %></small>
<% } ;%>

<% if ($what eq 'quotednames') { %>
<small><%= __('Do not enclose each line in quotes! It\'s possible to use dash-sign in the names too, if you wish to make some keys in various dictionaries to become unreadable.') %></small>
<% } ;%>

<% if ( $what =~ /^(main|anti|suffix)$/ && $cfg->{product}->{lang} eq 'vbs')  { %>
<p>
<small>
    <%= __('Enter symbols using any case since VBScript is case-insensitive, e.g BLAH and blaH and BLah will be treated the same. ')  %> 
</small>
<% } %>

<center>
<textarea name=symbols class=symlist id=symbols>
<%= join('',@$lines) %>
</textarea></center>
<p>

<p>
<% if ($cfg->{product}->{string_explorer} && $what eq 'main') { %>
<p>
<b><%$ __("In most cases you should add strings that contain just single symbol name  to this list - get the list of those symbols at  <a class=menuitemref 
    href=syms.strings>Symbols &rArr; View strings encountered in code</a> screen! This solves 99% of \"symbol not found\" errors!") %>
</b>
<% } %>





<% if ( $what =~ /^(main|suffix)$/ && $cfg->{product}->{lang} ne 'perl')  { %>
<p>
<%$ __("If you are using some 3rd party library, you should put symbols from its API here too. Get symbols from 3rd party APIs by using <a class=menuitemref 
    href=tools.syms_from_dir>Tools &rArr; Extract symbols from directory with source files</a> screen.") %>
<% } %>

<p>
<% $forge->include('wgt-submitbtn',__('Save'),'savebtn') %></center>
</form>


<% $forge->include('wgt-optional-start','filename',__('Editing the list in your favourite editor')) %>
<%$ sprintf(__('These lines are located in file <tt>%s</tt> in your project input directory. It\'s OK to edit this file with any text editor too.'),
    $filename) %>
<% $forge->include('wgt-optional-end','filename') %>


<script>
var save_str = jQuery("#savebtn").attr('value'); //back it up
function mark_saved(is_saved) 
{
    jQuery("#savebtn").attr('disabled',is_saved ? true : false);
    jQuery("#savebtn").attr('value',is_saved ? jQuery("#form").attr('saved_string') : save_str );
}

jQuery(function() {
    mark_saved(1);
    jQuery("#symbols").on('change input selectionchange propertychange',function() {
	mark_saved(0);
    });
    jQuery("#form").on('submit',function(e) {
	var url_ = 'syms.ajax.' + jQuery(this).attr('kind');
	jQuery.ajax({
           type: "POST",
           url: url_,
           data: jQuery(this).serialize(), // serializes the form's elements.
           success: function(data)
           {
		mark_saved(1);
           }
         });
	e.preventDefault(); // avoid to execute the actual submit of the form.	
    });
});
</script>
