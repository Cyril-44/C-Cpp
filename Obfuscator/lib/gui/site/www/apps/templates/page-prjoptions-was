<%
    use obfui::cmn;
    my ($s,$prj,$typehtml,$filename,$cfgref) = @_;

    $prj->{symbols_subdir} = $cfgref->{symfiles_subdir}
	if !length($prj->{symbols_subdir});

    my $placeholder = "Put project description here. HTML markup allowed, including links. It will be shown as tooltip in Project-Open screen";
    my $description_html = '</td><tr><td colspan=2><textarea name=description style="width:100%" rows=7 placeholder="' . 
	    $placeholder . '">' .
	    $forge->escape_html($prj->{description})
	. '</textarea></td>';

    my @popts = (
	[__('Main settings'),	'heading'						],
	[hstr('prj.title',__('Project title')),		'entry',	$prj->{title},	'title'],
	[hstr('prj.indir',__('Input directory')),	'direntry',	$prj->{indir},	'indir'],
	[hstr('prj.outdir',__('Output directory')),	'direntry',	$prj->{outdir},	'outdir'],
	[hstr('prj.stdir',__('State files directory')),	'direntry',	$prj->{stdir},	'stdir'],

	[__('Auxiliary settings'),	'heading'						],

	[hstr('prj.precmdline',__('Commandline to run BEFORE building project')),	
		    'entry',	$prj->{precmdline},	'precmdline'],
	[hstr('prj.postcmdline',__('Commandline to run AFTER building project')),
		    'entry',	$prj->{postcmdline},	'postcmdline'],
	[hstr('prj.testcmd',__('Test command')),	'entry',	$prj->{testcmdline},'testcmdline'],

	(length($typehtml) ? 
	[hstr('prj.codetype',__('Code type')),		'html',		$typehtml ] : ()),

	[hstr('prj.symbols_subdir',	__('Directory where list of symbols is stored')),	
		'entry',	$prj->{symbols_subdir}, 'symbols_subdir'],

	($cfgref->{product}->{lang} ne 'perl' ? 
	    (
		[hstr('prj.process_files_one_by_one',	__('Process files one by one')),	'checkbox',	
		$prj->{process_files_one_by_one}, 'process_files_one_by_one'] 
	    ) :  (
		[hstr('prj.perlpath',__('Path to Perl to use')),   'entry',	$prj->{perlpath}, 'perlpath'],
	    ) 
	),

	($cfgref->{product}->{lang} ne 'cxx' ? () : (
		[hstr('prj.cxx_ignore_exceptions_by_header',	__('Do not load exceptions for each #include\'d header file')),	
			    'checkbox',
			    $prj->{cxx_ignore_exceptions_by_header}, 'cxx_ignore_exceptions_by_header'],
		[hstr('prj.cxx_per_file_exceptions_are_not_aggregated',	__('Do not aggregate per-file exceptions extracted with Clang-based tool')),	
			    'checkbox',
			    $prj->{cxx_per_file_exceptions_are_not_aggregated}, 'cxx_per_file_exceptions_are_not_aggregated'],
	)),
	

	[hstr('prj.description',__('Project description')),		'html',		$description_html ],
    );
%>
<% $forge->include('wgt-init-filesysbrowser',$cfgref) %>


<form method=post>
<input type=hidden name=havevals value=1>

<div class=stretchformfields>
<table>
<%
    foreach my $i (@popts)
    {
	if ($i->[1] eq 'heading') {
%>
<tr><th colspan=2><center><%$ $i->[0] %></center></td>    
<%		next;
	} 
%>
<tr><td><%$ $i->[0] %></td><td <%= $i->[1] eq 'checkbox' ? '' : 'class=width-of-select' %>
    ><% if ($i->[1] =~ 'entry') 
	{ %>
	    <input class=text type=text name=<%$ $i->[3] %> id=<%$ $i->[3] %>
		value="<%= $i->[2] %>" style='width: 100%'></td>
	    <% if ($i->[1] eq 'direntry') { %>
		<td><script language=javascript>
		    <!--
			fsb_add_dir_browser(document.getElementById('<%$ $i->[3] %>'),document.getElementById('indir').value);
		    -->
		</script>
	    <% } %>
	    </td>
	<% 
	} elsif ($i->[1] eq 'checkbox') {
%>
	    <input class=checkbox type=checkbox name=<%$ $i->[3] %> id=<%$ $i->[3] %>
		<%$ $i->[2] ? 'checked' : '' %> ></td>
	<% 
	} else { 
	    print $i->[2]; 
	}
    }
%>
</table>
</div>
<p>

<div style='font-size: 60%'>
<%= __('The project file is stored in file named: ') %>
<code><%= $filename%></code>
<%= __('You can safely copy content of the directory it resides in to backup or move all your projects to another computer.') %>
</div>
<p>


<% $forge->include('wgt-gobtn',__('Delete this project'), 
    "project.delete",'confirm',
    __('Do you really wish to delete this project?'), 'class'=>'button-wide' ) %>
<p>


<p>

<% $forge->include('wgt-btns-ok-cancel') %>
</form>

